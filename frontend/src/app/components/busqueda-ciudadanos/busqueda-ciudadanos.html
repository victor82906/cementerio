<app-cabecera></app-cabecera>

<div class="bg-dark-custom py-4 shadow-sm mb-5">
    <div class="container text-white">
        <div class="row align-items-center">
            <div class="col-md-3 mb-3 mb-md-0 text-start">
                <button routerLink="/registro-ciudadano"
                    class="btn btn-success fw-bold text-uppercase w-100 py-2 shadow-sm">
                    <i class="bi bi-person-plus me-2"></i>Registrar Ciudadano
                </button>
            </div>
            <div class="col-md-9">
                <div class="input-group">
                    <input type="text" [(ngModel)]="busqueda" class="form-control"
                        placeholder="Buscar por nombre, apellidos o Email...">
                    <button (click)="buscar()" class="btn btn-primary-custom px-4">Buscar</button>
                </div>
                <small class="text-secondary mt-2 d-block">Resultados para: {{ busqueda || 'Todos los ciudadanos'
                    }}</small>
            </div>
        </div>
    </div>
</div>

<div class="container mb-5">
    <div class="row g-3">
        @if(cargando){
        <app-cargando></app-cargando>
        }@else{
        @for (ciudadano of ciudadanos; track ciudadano.id) {
        <div class="col-12">
            <div class="card border-secondary shadow-lg bg-dark-custom text-white card-horizontal">
                <div class="row g-0 align-items-center p-3">

                    <div class="col-md-2 text-center">
                        <img [src]="ciudadano.foto ? 'http://localhost:8081/uploads/' + ciudadano.foto : 'http://localhost:8081/uploads/perfilDefault.png'"
                            class="rounded-3 border border-secondary shadow-sm img-ciudadano" [alt]="ciudadano.nombre">
                    </div>

                    <div class="col-md-3 ps-md-4 mt-3 mt-md-0">
                        <h5 class="fw-bold mb-1 text-uppercase">{{ ciudadano.nombre }} {{ ciudadano.apellidos }}</h5>
                        <p class="text-primary-custom fw-bold mb-1">
                            <i class="bi bi-card-text me-2"></i>{{ ciudadano.dni }}
                        </p>
                        <p class="text-secondary small mb-0">
                            <i class="bi bi-geo-alt me-2"></i>{{ ciudadano.direccion }}
                        </p>
                    </div>

                    <div class="col-md-4 border-start border-secondary ps-md-4 mt-3 mt-md-0">
                        <p class="mb-1">
                            <i class="bi bi-envelope text-primary-custom me-2"></i>{{ ciudadano.email }}
                        </p>
                        <p class="mb-0">
                            <i class="bi bi-telephone text-primary-custom me-2"></i>{{ ciudadano.telefono }}
                        </p>
                    </div>

                    <div class="col-md-3 text-end mt-3 mt-md-0">
                        <div class="d-flex flex-column gap-2">
                            <button (click)="verDifuntos(ciudadano.id)"
                                class="btn btn-outline-light fw-bold py-2 shadow-sm custom-hover-btn">
                                <i class="bi bi-moisture me-2"></i>VER DIFUNTOS
                            </button>
                            <button (click)="editarCiudadano(ciudadano.id)" class="btn btn-warning fw-bold text-dark">
                                <i class="bi bi-pencil-square me-1"></i>EDITAR
                            </button>
                            <button (click)="borrarCiudadano(ciudadano.id)" class="btn btn-danger fw-bold">
                                <i class="bi bi-trash me-1"></i>BORRAR
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        } @empty {
        <div class="col-12 text-center py-5">
            <p class="text-muted">No se han encontrado resultados para esta b√∫squeda.</p>
            <button (click)="busqueda=''; buscar()" class="btn btn-link text-dark">Ver listado completo</button>
        </div>
        }
        }
    </div>
</div>

<app-footer></app-footer>

<app-modal-confirmar #modalConfirmar (accionConfirmada)="confirmarBorrado()"></app-modal-confirmar>